@(userId: String, role: String)

<!doctype html>
<html>
<head> 
  <meta charset="utf-8" />
  <title>MySpace â€” Interviews</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 24px; }
      .page-header { display:flex; align-items:baseline; justify-content:space-between; }
      .page-header h1 { margin: 0; }
      .subtle { opacity: 0.75; }
      .error { padding: 12px; border: 1px solid #ccc; border-radius: 8px; margin: 12px 0; }
      .iv-notice { padding: 10px; border-radius: 8px; margin: 10px 0; }
      .iv-notice-error { border: 1px solid #d33; }
      .iv-notice-warn  { border: 1px solid #cc0; }
      .iv-notice-msg { margin-left: 8px; opacity: 0.85; }
      .iv-retry { margin-left: 12px; }
    </style>
</head>
<body data-user-id="@userId" data-role="@role">
  <div class="page-header">
    <h1>Interviews</h1>
    <div class="subtle">/user/interviews</div>
  </div>

  <p class="subtle">
    Full list of your interviews. Use filters to narrow results.
  </p>

  <div id="interviews-summary-root"></div>
  <script src='@routes.Assets.at("frontend/interviews-pane.js")'></script>
  <script>
    function getPageContext() {
      const body = document.body;
      return {
        userId: body.dataset.userId,
        role: body.dataset.role
      };
    }

    async function loadInterviews() {
      const { userId, role } = getPageContext();
      if (!userId || !role) throw new Error("Missing userId/role on page");

      const url = `/api/v1/interviews?userId=${encodeURIComponent(userId)}&role=${encodeURIComponent(role)}&limit=100&offset=0`;
      const res = await fetch(url, { credentials: "include" });
      if (!res.ok) throw new Error("Failed to load interviews: " + res.status);

      const data = await res.json();
      return data.items || [];
    }

    (async function init() {
      const root = document.getElementById("interviews-summary-root");
      const { role } = getPageContext();

      // Create pane first (FR6-ready)
      root.innerHTML = "";
      const pane = new InterviewsPane(root, {
        interviews: [],
        defaultRangeDays: 14,
        role,
        staleAfterMinutes: 10,
        onRetry: () => init()
      });

      // Summary page should show all by default
      pane.statusFilter = "all";
      pane.render();

      try {
        const list = await loadInterviews();
        pane.interviews = list;
        pane.loadError = null;
        pane.lastUpdatedAt = new Date();
        pane.render();
      } catch (e) {
        pane.interviews = [];
        pane.loadError = String(e.message || e);
        pane.render();
      }
    })();
  </script>
</body>
</html>
