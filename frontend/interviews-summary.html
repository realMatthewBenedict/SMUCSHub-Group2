<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>MySpace — Interviews</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 24px; }
      .page-header { display:flex; align-items:baseline; justify-content:space-between; }
      .page-header h1 { margin: 0; }
      .subtle { opacity: 0.75; }
      .error { padding: 12px; border: 1px solid #ccc; border-radius: 8px; margin: 12px 0; }
    </style>
  </head>

  <body data-user-id="REPLACE_ME" data-role="student">
    <div class="page-header">
      <h1>Interviews</h1>
      <div class="subtle">/user/interviews</div>
    </div>

    <p class="subtle">
      Full list of your interviews. Use filters to narrow results.
    </p>

    <div id="interviews-summary-root"></div>

    <script src="/Interviews/interviews-pane.js"></script>

    <script>
    function getPageContext() {
      const body = document.body;
      return {
        userId: body.dataset.userId,
        role: body.dataset.role
      };
    }

    async function loadInterviews() {
      const { userId, role } = getPageContext();
      if (!userId || !role) throw new Error("Missing userId/role on page");

      const url = `/api/v1/interviews?userId=${encodeURIComponent(userId)}&role=${encodeURIComponent(role)}&limit=100&offset=0`;
      const res = await fetch(url, { credentials: "include" });
      if (!res.ok) throw new Error("Failed to load interviews: " + res.status);

      const data = await res.json();
      return data.items || [];
    }

    (async function init() {
      const root = document.getElementById("interviews-summary-root");
      root.innerHTML = "<p>Loading interviews…</p>";

      try {
        const list = await loadInterviews();
        root.innerHTML = "";

        const pane = new InterviewsPane(root, {
          interviews: list,
          defaultRangeDays: 14
        });

        pane.statusFilter = "all";
        pane.render();
      } catch (e) {
        root.innerHTML = `
          <div class="error">
            <strong>Interviews currently unavailable.</strong>
            <div class="subtle">${String(e.message || e)}</div>
            <button id="retry">Retry</button>
          </div>
        `;
        document.getElementById("retry").onclick = () => location.reload();
      }
    })();
  </script>

</body>
</html>
