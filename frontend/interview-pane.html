<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interviews Pane</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .interviews-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .title {
      margin-top: 0;
    }
    .filters {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .filters select, .filters input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .iv-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .iv-card {
      border: 1px solid #e0e0e0;
      padding: 15px;
      border-radius: 6px;
    }
    .iv-top {
      display: flex;
      justify-content: space-between;
      align-items: start;
    }
    .iv-title {
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 5px;
    }
    .iv-date {
      color: #666;
      font-size: 0.9em;
    }
    .iv-interviewer {
      color: #444;
      margin-top: 5px;
    }
    .toggle-btn {
      padding: 6px 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .toggle-btn:hover {
      background: #0056b3;
    }
    .iv-details {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
    }
    .iv-details p {
      margin: 8px 0;
    }
    .none {
      color: #999;
      text-align: center;
      padding: 40px;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    class InterviewsPane {
      constructor(container, options) {
        this.container = container;
        this.interviews = options.interviews || [];
        this.rangeDays = options.defaultRangeDays || 14;
        this.maxItems = options.maxItems !== undefined ? options.maxItems : 7;
        this.statusFilter = "upcoming";
        this.postingFilter = "";
        this.textSearch = "";
        this.sortBy = "date";
        this.expandedId = null;
        this.render();
      }

      getStartDate(iv) {
        return new Date(iv.startTime);
      }

      interviewerDisplay(iv) {
        var arr = Array.isArray(iv.interviewers) ? iv.interviewers : [];
        if (arr.length === 0) return "-";
        var names = arr.map(function(x) { return x && x.name; }).filter(Boolean);
        return names.length > 0 ? names.join(", ") : "-";
      }

      postingDisplay(iv) {
        return iv.postingTitle || iv.postingId || "-";
      }

      notesDisplay(iv) {
        return (iv && iv.metadata && iv.metadata.notes) || "None";
      }

      isUrl(s) {
        return /^https?:\/\//i.test(String(s || ""));
      }

      statusRank(status) {
        switch (status) {
          case "scheduled": return 0;
          case "completed": return 1;
          case "cancelled": return 2;
          default: return 3;
        }
      }

      isUpcoming(iv, now, cutoff) {
        var d = this.getStartDate(iv);
        return iv.status === "scheduled" && d >= now && d <= cutoff;
      }

      passesStatusFilter(iv, now, cutoff) {
        if (this.statusFilter === "all") return true;
        if (this.statusFilter === "upcoming") return this.isUpcoming(iv, now, cutoff);
        return iv.status === this.statusFilter;
      }

      filterInterviews() {
        var self = this;
        var now = new Date();
        var cutoff = new Date(now.getTime() + this.rangeDays * 86400000);
        var q = this.textSearch.trim().toLowerCase();

        var filtered = this.interviews.filter(function(iv) {
          if (!self.passesStatusFilter(iv, now, cutoff)) return false;
          var posting = self.postingDisplay(iv);
          if (self.postingFilter && posting !== self.postingFilter) return false;
          if (q) {
            var jobTitle = (iv.postingTitle || "").toLowerCase();
            var interviewers = self.interviewerDisplay(iv).toLowerCase();
            var hay = (jobTitle + " " + interviewers).trim();
            if (hay.indexOf(q) === -1) return false;
          }
          return true;
        });

        return filtered.sort(function(a, b) {
          var da = self.getStartDate(a);
          var db = self.getStartDate(b);
          if (self.sortBy === "status") {
            var ra = self.statusRank(a.status);
            var rb = self.statusRank(b.status);
            if (ra !== rb) return ra - rb;
            return da - db;
          }
          return da - db;
        });
      }

      setFilter(type, value) {
        this[type] = value;
        this.render();
      }

      toggleExpand(id) {
        this.expandedId = this.expandedId === id ? null : id;
        this.render();
      }

      render() {
        var self = this;
        var results = this.filterInterviews();
        
        var postingsSet = {};
        var filtered = this.interviews.filter(function(iv) {
          var now = new Date();
          var cutoff = new Date(now.getTime() + self.rangeDays * 86400000);
          return self.passesStatusFilter(iv, now, cutoff);
        });
        
        filtered.forEach(function(iv) {
          var p = self.postingDisplay(iv);
          if (p && p !== "-") postingsSet[p] = true;
        });
        var postings = Object.keys(postingsSet).sort();
        
        if (this.statusFilter === "upcoming" && this.maxItems) {
          results = results.slice(0, this.maxItems);
        }

        var html = '<div class="interviews-box"><h2 class="title">Interviews</h2><div class="filters">';
        html += '<select id="filter-status"><option value="upcoming">Upcoming</option><option value="completed">Completed</option><option value="cancelled">Cancelled</option><option value="all">All</option></select>';
        
        if (this.statusFilter === "upcoming") {
          html += '<select id="filter-range"><option value="7">Next 7 days</option><option value="14">Next 14 days</option></select>';
        }
        
        html += '<select id="filter-posting"><option value="">All Postings</option>';
        postings.forEach(function(p) {
          html += '<option value="' + self.escapeHtml(p) + '">' + self.escapeHtml(p) + '</option>';
        });
        html += '</select>';
        
        html += '<select id="sort-by"><option value="date">Sort by date</option><option value="status">Sort by status</option></select>';
        html += '<input id="filter-text" placeholder="Search interviewer or posting title"></div>';
        
        html += '<div class="iv-list">';
        if (results.length === 0) {
          html += '<p class="none">No interviews found.</p>';
        } else {
          results.forEach(function(iv) {
            var id = iv.interviewId;
            var start = self.getStartDate(iv);
            var tz = iv.timezone || "-";
            var title = self.postingDisplay(iv);
            var interviewers = self.interviewerDisplay(iv);
            
            html += '<div class="iv-card"><div class="iv-top"><div>';
            html += '<div class="iv-title">' + self.escapeHtml(title) + '</div>';
            html += '<div class="iv-date">' + self.escapeHtml(start.toLocaleString()) + ' (' + self.escapeHtml(tz) + ')</div>';
            html += '<div class="iv-interviewer">Interviewer(s): ' + self.escapeHtml(interviewers) + '</div>';
            html += '</div><button class="toggle-btn" data-id="' + self.escapeHtml(id) + '">';
            html += (self.expandedId === id ? "Hide" : "Details") + '</button></div>';
            
            if (self.expandedId === id) {
              html += '<div class="iv-details">';
              html += '<p><strong>Status:</strong> ' + self.escapeHtml(iv.status || "-") + '</p>';
              html += '<p><strong>Role:</strong> ' + self.escapeHtml(iv.role || "-") + '</p>';
              html += '<p><strong>Posting:</strong> ' + self.escapeHtml(self.postingDisplay(iv)) + '</p>';
              html += '<p><strong>Location:</strong> ';
              if (self.isUrl(iv.location)) {
                html += '<a href="' + self.escapeHtml(iv.location) + '" target="_blank" rel="noopener noreferrer">' + self.escapeHtml(iv.location) + '</a>';
              } else {
                html += self.escapeHtml(iv.location || "-");
              }
              html += '</p>';
              html += '<p><strong>Notes:</strong> ' + self.escapeHtml(self.notesDisplay(iv)) + '</p>';
              html += '<p><strong>Timezone:</strong> ' + self.escapeHtml(iv.timezone || "-") + '</p>';
              html += '<p><strong>Start:</strong> ' + self.escapeHtml(self.getStartDate(iv).toLocaleString()) + '</p>';
              html += '<p><strong>End:</strong> ' + self.escapeHtml(iv.endTime ? new Date(iv.endTime).toLocaleString() : "-") + '</p>';
              html += '</div>';
            }
            html += '</div>';
          });
        }
        html += '</div></div>';

        this.container.innerHTML = html;

        var statusEl = this.container.querySelector("#filter-status");
        statusEl.value = this.statusFilter;
        statusEl.onchange = function(e) { self.setFilter("statusFilter", e.target.value); };

        var rangeEl = this.container.querySelector("#filter-range");
        if (rangeEl) {
          rangeEl.value = String(this.rangeDays);
          rangeEl.onchange = function(e) {
            self.rangeDays = Number(e.target.value);
            self.render();
          };
        }

        var postingEl = this.container.querySelector("#filter-posting");
        postingEl.value = this.postingFilter;
        postingEl.onchange = function(e) { self.setFilter("postingFilter", e.target.value); };

        var sortEl = this.container.querySelector("#sort-by");
        sortEl.value = this.sortBy;
        sortEl.onchange = function(e) { self.setFilter("sortBy", e.target.value); };

        var textEl = this.container.querySelector("#filter-text");
        textEl.value = this.textSearch;
        textEl.oninput = function(e) { self.setFilter("textSearch", e.target.value); };

        var toggleBtns = this.container.querySelectorAll(".toggle-btn");
        toggleBtns.forEach(function(btn) {
          btn.onclick = function() { self.toggleExpand(btn.dataset.id); };
        });
      }

      escapeHtml(s) {
        var str = String(s !== null && s !== undefined ? s : "");
        str = str.replace(/&/g, "&amp;");
        str = str.replace(/</g, "&lt;");
        str = str.replace(/>/g, "&gt;");
        str = str.replace(/"/g, "&quot;");
        str = str.replace(/'/g, "&#039;");
        return str;
      }
    }

    var sampleInterviews = [
      {
        interviewId: "1",
        postingTitle: "Software engineering research assistant-backend",
        startTime: new Date(Date.now() + 2 * 86400000).toISOString(),
        endTime: new Date(Date.now() + 2 * 86400000 + 3600000).toISOString(),
        status: "scheduled",
        role: "Backend development assistant",
        location: "https://zoom.us/j/123456789",
        timezone: "PST",
        interviewers: [{name: "John Doe"}, {name: "Jane Smith"}],
        metadata: {notes: "Technical round - focus on system design"}
      },
      {
        interviewId: "2",
        postingTitle: "Advertising research assistant",
        startTime: new Date(Date.now() - 5 * 86400000).toISOString(),
        endTime: new Date(Date.now() - 5 * 86400000 + 3600000).toISOString(),
        status: "completed",
        role: "data collection",
        location: "Conference Room A",
        timezone: "EST",
        interviewers: [{name: "Alice Johnson"}],
        metadata: {notes: "Behavioral interview completed"}
      },
      {
        interviewId: "3",
        postingTitle: "Software engineering research assistant-frontend",
        startTime: new Date(Date.now() + 1 * 86400000).toISOString(),
        endTime: new Date(Date.now() + 1 * 86400000 + 3600000).toISOString(),
        status: "scheduled",
        role: "Frontend development assistant",
        location: "https://meet.google.com/abc-defg-hij",
        timezone: "EST",
        interviewers: [{name: "Sarah Wilson"}],
        metadata: {notes: "React and TypeScript coding challenge"}
      },
      {
        interviewId: "4",
        postingTitle: "AI/ML research assistnant",
        startTime: new Date(Date.now() + 5 * 86400000).toISOString(),
        endTime: new Date(Date.now() + 5 * 86400000 + 3600000).toISOString(),
        status: "scheduled",
        role: "monitoring running models",
        location: "https://zoom.us/j/987654321",
        timezone: "PST",
        interviewers: [{name: "Michael Chen"}, {name: "Emily Rodriguez"}],
        metadata: {notes: "Final round with engineering leadership"}
      },
      {
        interviewId: "5",
        postingTitle: "Data Science assistant",
        startTime: new Date(Date.now() + 3 * 86400000).toISOString(),
        endTime: new Date(Date.now() + 3 * 86400000 + 5400000).toISOString(),
        status: "scheduled",
        role: "sorting and labeling data",
        location: "Building 2, Room 301",
        timezone: "CST",
        interviewers: [{name: "Dr. James Patterson"}],
        metadata: {notes: "Machine learning case study presentation"}
      },
      {
        interviewId: "6",
        postingTitle: "Chemical Engineering reasearch assistant",
        startTime: new Date(Date.now() + 8 * 86400000).toISOString(),
        endTime: new Date(Date.now() + 8 * 86400000 + 3600000).toISOString(),
        status: "scheduled",
        role: "material synthesis and testing",
        location: "https://teams.microsoft.com/l/meetup",
        timezone: "EST",
        interviewers: [{name: "Lisa Anderson"}, {name: "Tom Bradley"}],
        metadata: {notes: "materials science technical questions"}
      },
      {
        interviewId: "7",
        postingTitle: "Mechanical Engineering research assistant",
        startTime: new Date(Date.now() + 10 * 86400000).toISOString(),
        endTime: new Date(Date.now() + 10 * 86400000 + 3600000).toISOString(),
        status: "scheduled",
        role: "testing and prototyping",
        location: "https://zoom.us/j/555123456",
        timezone: "PST",
        interviewers: [{name: "Kevin Park"}],
        metadata: {notes: "worked on mechanical design problems"}
      },
      {
        interviewId: "8",
        postingTitle: "DevOps Engineering assistant",
        startTime: new Date(Date.now() + 4 * 86400000).toISOString(),
        endTime: new Date(Date.now() + 4 * 86400000 + 3600000).toISOString(),
        status: "scheduled",
        role: "DevOps Engineer",
        location: "https://zoom.us/j/111222333",
        timezone: "MST",
        interviewers: [{name: "Rachel Green"}, {name: "David Lee"}],
        metadata: {notes: "Infrastructure and CI/CD pipeline review"}
      },
      {
        interviewId: "9",
        postingTitle: "Guildhall research assistant",
        startTime: new Date(Date.now() - 2 * 86400000).toISOString(),
        endTime: new Date(Date.now() - 2 * 86400000 + 3600000).toISOString(),
        status: "cancelled",
        role: "game developer",
        location: "https://zoom.us/j/cancelled123",
        timezone: "PST",
        interviewers: [{name: "Chris Martinez"}],
        metadata: {notes: "Cancelled due to candidate scheduling conflict"}
      },
      {
        interviewId: "10",
        postingTitle: "Data analyst assistant",
        startTime: new Date(Date.now() - 10 * 86400000).toISOString(),
        endTime: new Date(Date.now() - 10 * 86400000 + 3600000).toISOString(),
        status: "completed",
        role: "Junior Data Scientist",
        location: "Conference Room B",
        timezone: "EST",
        interviewers: [{name: "Angela Thompson"}],
        metadata: {notes: "Initial screening completed successfully"}
      },
      {
        interviewId: "11",
        postingTitle: "UI/UX Design assistant",
        startTime: new Date(Date.now() + 6 * 86400000).toISOString(),
        endTime: new Date(Date.now() + 6 * 86400000 + 3600000).toISOString(),
        status: "scheduled",
        role: "UX Designer",
        location: "https://zoom.us/j/design123",
        timezone: "PST",
        interviewers: [{name: "Sophie Turner"}, {name: "Mark Johnson"}],
        metadata: {notes: "Portfolio review and design critique"}
      },
      {
        interviewId: "12",
        postingTitle: "coffee run assistant",
        startTime: new Date(Date.now() + 12 * 86400000).toISOString(),
        endTime: new Date(Date.now() + 12 * 86400000 + 3600000).toISOString(),
        status: "scheduled",
        role: "grab coffee for reserachers",
        location: "https://meet.google.com/xyz-test-789",
        timezone: "EST",
        interviewers: [{name: "Brian Foster"}],
        metadata: {notes: "technical interview"}
      }
    ];

    new InterviewsPane(document.getElementById('app'), {
      interviews: sampleInterviews,
      defaultRangeDays: 14,
      maxItems: 100
    });
  </script>
</body>
</html>